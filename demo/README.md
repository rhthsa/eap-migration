# Migrate to JBoss EAP Demo

## Prerequisite

1. IDE - Visual Studio Code, CodeReady Studio or CodeReady Workspace
2. Migration Toolkit for Application (MTA)
    * Plugin - If you need to use it with the IDE
    * Command Line Interface - completed CLI
    * Web Console - Comes with JBoss EAP

3. JBoss EAP 7.x
4. Docker

## MTA Installation

For the MTA plugin, you can install it via the IDE plugin feature e.g. VSCode Extension for Visual Studio Code or the marketplace for CodeReady Studio.

If you need to go with command line or web console flavour, you can follow this instruction.

1. Go to [Red Hat Developer portral](https://developers.redhat.com/)

2. Navigate to **Tools -> Migration Toolkit for Applications -> Download** (or just click on this [link](https://developers.redhat.com/products/mta/download))

3. Download the version you want.

4. Take a look at this [Getting Started](https://developers.redhat.com/products/mta/getting-started) guide.

## Database setup

The application requires a PostgreSQL database so we need start and setup a PostgreSQL database using Docker.

`docker run -p 5432:5432 -e POSTGRES_USER=coolstore -e POSTGRES_PASSWORD=coolstore123 -e POSTGRES_DB=monolith postgres`

## JBoss EAP setup

### Enable Admin user

1. Run `$JBOSS_HOME/bin/add-user.sh`

2. When it asks **What type of user do you wish to add?** select `a) Management User (mgmt-users.properties)`

3. Enter `admin`

4. Select `a) Update the existing user password and roles`

5. Enter a password for `admin` user.

6. Re-enter the password again.

7. Answer `yes` for **Is this new user going to be used for one AS process to connect to another AS process?** question.

### Add new DataSource

1. Download PostgreSQL JDBC Driver from [here](https://jdbc.postgresql.org/download.html)

2. Run `$JBOSS_HOME/bin/jboss-cli.sh`

3. Enter `connect` to connect to server.

4. Add Postgres module. Enter `module add --name=org.postgres --resources=/path/to/postgresql/jdbc driver.jar --dependencies=javax.api,javax.transaction.api`

5. Add Postgres driver to DataSources subsystem. Enter `/subsystem=datasources/jdbc-driver=postgres:add(driver-name="postgres",driver-module-name="org.postgres",driver-class-name=org.postgresql.Driver)`

6. Add a DataSource for the application. Enter `data-source add --jndi-name=java:jboss/datasources/CoolstoreDS --name=CoolstorePool --connection-url=jdbc:postgresql://localhost:5432/postgres --driver-name=postgres --user-name=coolstore --password=coolstore123`

### Add JMS topic

1. Run `$JBOSS_HOME/bin/jboss-cli.sh`

2. Enter `connect` to connect to server.

3. Add a new topic. Ente `jms-topic add --topic-address=ordersTopic --entries=topic/orders`

## Demo instructions

1. Clone this repository to you local machine.
2. Switch to the `weblogic` branch.
3. Run MTA to analyze the application and generate a report.
    * For **CLI**, `./mta-cli --sourceMode --input /path/to/eap-migration/demo/project/monolith --output /path/for/report --target eap7 --source weblogic`
    * For **Visual Studio Code**, Use the MTA plugin to create a MTA Configuration and run it.
    * For **CodeReady Studio**, a Run Configuration needs to be created. Check this [guide](https://access.redhat.com/documentation/en-us/migration_toolkit_for_applications/5.1/html/ide_plugin_guide/index) for how to do it.
4. Show the report to audience. And explain how the MTA helps developer to do code migration.
5. Fix the code as per suggestions in the report generated by MTA. Fixing only the mandatory issues should be fine. (You don't have to do this at demo time)
6. Switch to `eap7` branch. The code in this branch is already fixed.
7. Run MTA again and show the audience how the report looks like after code fixes.
8. Navigate to `eap-migration/demo/project/monolith` directory and Run `maven clean package` to generate an artefact for delpoyment. `ROOT.war` file will be generated in `monolith/target` directory.
9. Run `$JBOSS_HOME/bin/./standalone.sh -c standalone-full.xml` (JMS requires full profile)
10. Deploy the artefact to EAP server by copy the `ROOT.war` file to `$JBOSS_HOME/standalone/deployments` directory. And check the logs to make sure the deployment is successful.
11. Open the website we just deployed <http://localhost:8080/>
